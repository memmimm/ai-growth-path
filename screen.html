<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Growth Path - Live Screen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0e27;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        /* 메인 컨테이너 */
        .universe-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: radial-gradient(ellipse at center, #1a1f3a 0%, #0a0e27 100%);
        }

        /* 상단 카운터 */
        .counter-top {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            animation: fadeIn 1s ease;
        }

        .counter-number {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .counter-text {
            font-size: 1.5rem;
            color: #a8b2d1;
        }

        /* 중앙 AI CORE */
        .ai-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            animation: pulse 3s ease-in-out infinite;
        }

        .ai-core-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        /* 궤도 (Orbits) */
        .orbit {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .orbit.explorer {
            width: 300px;
            height: 300px;
            border-color: rgba(102, 126, 234, 0.15);
        }

        .orbit.maker {
            width: 550px;
            height: 550px;
            border-color: rgba(245, 87, 108, 0.15);
        }

        .orbit.navigator {
            width: 800px;
            height: 800px;
            border-color: rgba(79, 172, 254, 0.15);
        }

        /* 별 (Stars) */
        .star {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: orbitRotate var(--duration, 60s) linear infinite, twinkle 3s ease-in-out infinite;
        }

        .star:hover {
            transform: scale(1.5);
            z-index: 10;
        }

        .star.explorer {
            background: radial-gradient(circle, #667eea 0%, rgba(102, 126, 234, 0.5) 100%);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.8);
        }

        .star.maker {
            background: radial-gradient(circle, #f5576c 0%, rgba(245, 87, 108, 0.5) 100%);
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.8);
        }

        .star.navigator {
            background: radial-gradient(circle, #4facfe 0%, rgba(79, 172, 254, 0.5) 100%);
            box-shadow: 0 0 25px rgba(79, 172, 254, 0.8);
        }

        @keyframes starAppear {
            from {
                opacity: 0;
                transform: scale(0);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* 통합된 궤도 회전 애니메이션 (CSS 변수 사용) */
        @keyframes orbitRotate {
            from { 
                transform: rotate(var(--start-angle, 0deg)) translateX(var(--radius, 150px)) rotate(calc(-1 * var(--start-angle, 0deg))); 
            }
            to { 
                transform: rotate(calc(var(--start-angle, 0deg) + 360deg)) translateX(var(--radius, 150px)) rotate(calc(-1 * (var(--start-angle, 0deg) + 360deg))); 
            }
        }

        /* 하단 메시지 */
        .message-bottom {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            font-size: 1.8rem;
            color: #a8b2d1;
            animation: fadeIn 1s ease;
        }

        /* 알림 메시지 (새 별 추가 시) */
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 30px 50px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 2rem;
            font-weight: 600;
            text-align: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            animation: notificationPop 3s ease;
        }

        @keyframes notificationPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* 범례 */
        .legend {
            position: absolute;
            bottom: 40px;
            right: 40px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .legend-dot.explorer { background: #667eea; box-shadow: 0 0 10px rgba(102, 126, 234, 0.5); }
        .legend-dot.maker { background: #f5576c; box-shadow: 0 0 10px rgba(245, 87, 108, 0.5); }
        .legend-dot.navigator { background: #4facfe; box-shadow: 0 0 10px rgba(79, 172, 254, 0.5); }

        /* 애니메이션 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 로딩 */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 100;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="universe-container">
        <!-- 로딩 -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>AI Universe를 불러오는 중...</p>
        </div>

        <!-- 상단 카운터 -->
        <div class="counter-top" id="counterTop" style="display: none;">
            <div class="counter-number" id="counterNumber">0</div>
            <div class="counter-text">개의 별이 생성되었습니다</div>
        </div>

        <!-- 중앙 AI CORE -->
        <div class="ai-core">
            <div class="ai-core-text">AI CORE</div>
        </div>

        <!-- 궤도들 -->
        <div class="orbit explorer"></div>
        <div class="orbit maker"></div>
        <div class="orbit navigator"></div>

        <!-- 별들이 여기에 추가됨 -->
        <div id="starsContainer"></div>

        <!-- 하단 메시지 -->
        <div class="message-bottom">
            당신의 별이 AI Universe를 완성합니다 ✨
        </div>

        <!-- 알림 메시지 -->
        <div class="notification" id="notification">
            새로운 별이 Explorer Orbit에 추가되었습니다 ✨
        </div>

        <!-- 범례 -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot explorer"></div>
                <span>Explorer Orbit</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot maker"></div>
                <span>Maker Orbit</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot navigator"></div>
                <span>Navigator Orbit</span>
            </div>
        </div>
    </div>

    <script>
        // 설정
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby8d5sYiM5P6M1Gh7m9K9aLgl3fhVX71tVkxevAoEX2lcU7VzhLtVxUTCbS6h6_gZT3/exec';
        const REFRESH_INTERVAL = 3000; // 3초마다 새로고침
        
        let currentStarCount = 0;
        let lastDataLength = 0;

        // 궤도 반지름 설정
        const orbitRadius = {
            explorer: 150,  // 중심 궤도
            maker: 275,     // 중간 궤도
            navigator: 400  // 외곽 궤도
        };

        // 데이터 가져오기
        async function fetchData() {
            try {
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();
                
                if (result.status === 'success') {
                    return result.data;
                }
                return [];
            } catch (error) {
                console.error('데이터 가져오기 실패:', error);
                // 에러 시 더미 데이터로 테스트
                return generateDummyData();
            }
        }

        // 더미 데이터 생성 (테스트용)
        function generateDummyData() {
            const orbits = ['explorer', 'maker', 'navigator'];
            const dummyData = [];
            const count = Math.floor(Math.random() * 5) + lastDataLength; // 매번 0-5개씩 추가
            
            for (let i = lastDataLength; i < count; i++) {
                dummyData.push({
                    timestamp: new Date(),
                    result: orbits[Math.floor(Math.random() * orbits.length)]
                });
            }
            return dummyData;
        }

        // 별 생성 함수
        function createStar(orbit, index, total) {
            const star = document.createElement('div');
            star.className = `star ${orbit}`;
            
            // 각 별마다 고유한 ID 부여
            const uniqueId = `star-${orbit}-${Date.now()}-${Math.random()}`;
            star.id = uniqueId;
            
            // 완전히 랜덤한 시작 각도 (degree)
            const startAngleDeg = Math.random() * 360;
            
            // 궤도 반지름
            const radius = orbitRadius[orbit];
            
            // 중앙 기준 위치
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // 별 크기
            const size = orbit === 'explorer' ? 8 : orbit === 'maker' ? 12 : 16;
            
            // 회전 시간
            const rotationDuration = orbit === 'explorer' ? 60 : orbit === 'maker' ? 90 : 120;
            
            // 스타일 설정 - 중앙에 배치하고 transform으로 궤도 위치
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            star.style.left = centerX + 'px';
            star.style.top = centerY + 'px';
            star.style.setProperty('--start-angle', startAngleDeg + 'deg');
            star.style.setProperty('--radius', radius + 'px');
            star.style.setProperty('--duration', rotationDuration + 's');
            
            // 초기 transform 설정 (바로 궤도 위에 배치)
            star.style.transform = `rotate(${startAngleDeg}deg) translateX(${radius}px) rotate(-${startAngleDeg}deg)`;
            
            // 반짝임 랜덤 딜레이
            star.style.animationDelay = `0s, ${Math.random() * 3}s`;
            
            console.log(`${orbit} 별: 각도=${startAngleDeg.toFixed(0)}°, 반지름=${radius}px`);
            
            return star;
        }

        // 별 추가 애니메이션
        function addNewStar(orbit) {
            const container = document.getElementById('starsContainer');
            const existingStars = container.querySelectorAll(`.star.${orbit}`);
            const star = createStar(orbit, existingStars.length, existingStars.length + 1);
            
            container.appendChild(star);
            
            // 알림 표시
            showNotification(orbit);
        }

        // 알림 표시
        function showNotification(orbit) {
            const notification = document.getElementById('notification');
            const orbitNames = {
                explorer: 'Explorer Orbit',
                maker: 'Maker Orbit',
                navigator: 'Navigator Orbit'
            };
            
            notification.textContent = `새로운 별이 ${orbitNames[orbit]}에 추가되었습니다 ✨`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 카운터 업데이트
        function updateCounter(count) {
            const counterNumber = document.getElementById('counterNumber');
            
            // 숫자 카운트 애니메이션
            const start = currentStarCount;
            const end = count;
            const duration = 500;
            const startTime = performance.now();
            
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const current = Math.floor(start + (end - start) * progress);
                counterNumber.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
            currentStarCount = count;
        }

        // 초기 별 생성 (전체 데이터)
        function initializeStars(data) {
            console.log('=== initializeStars 시작 ===');
            console.log('전체 데이터:', data);
            console.log('데이터 개수:', data.length);
            
            const container = document.getElementById('starsContainer');
            container.innerHTML = '';
            
            // 궤도별로 그룹화
            const orbitGroups = {
                explorer: [],
                maker: [],
                navigator: []
            };
            
            data.forEach((item, idx) => {
                console.log(`데이터 ${idx}:`, item, '결과:', item.result);
                if (item.result && orbitGroups[item.result]) {
                    orbitGroups[item.result].push(item);
                }
            });
            
            console.log('궤도별 그룹:', orbitGroups);
            console.log('Explorer:', orbitGroups.explorer.length);
            console.log('Maker:', orbitGroups.maker.length);
            console.log('Navigator:', orbitGroups.navigator.length);
            
            // 각 궤도별로 별 생성
            Object.keys(orbitGroups).forEach(orbit => {
                const items = orbitGroups[orbit];
                console.log(`${orbit} 별 생성 시작:`, items.length, '개');
                items.forEach((item, index) => {
                    const star = createStar(orbit, index, items.length);
                    container.appendChild(star);
                });
            });
            
            console.log('=== initializeStars 완료 ===');
            updateCounter(data.length);
        }

        // 데이터 업데이트 체크
        async function checkForUpdates() {
            const data = await fetchData();
            
            if (data.length > lastDataLength) {
                // 새로운 데이터가 있음
                const newItems = data.slice(lastDataLength);
                
                newItems.forEach(item => {
                    if (item.result) {
                        addNewStar(item.result);
                    }
                });
                
                updateCounter(data.length);
                lastDataLength = data.length;
            }
        }

        // 초기화
        async function init() {
            const data = await fetchData();
            
            // 로딩 숨기기
            document.getElementById('loading').style.display = 'none';
            document.getElementById('counterTop').style.display = 'block';
            
            // 초기 별 생성
            initializeStars(data);
            lastDataLength = data.length;
            
            // 주기적으로 업데이트 체크
            setInterval(checkForUpdates, REFRESH_INTERVAL);
        }

        // 페이지 로드 시 실행
        window.addEventListener('load', init);

        // 리사이즈 시 별 위치 재계산
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(async () => {
                const data = await fetchData();
                initializeStars(data);
            }, 500);
        });
    </script>
</body>
</html>
